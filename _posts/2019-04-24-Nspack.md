---
title: Nspack脱壳--SHCTF 2017crackme
date: 2019-04-24 22:52:02
tags: [Record,Reverse]
categories: 
            - record
            - reverse
---
学习了一波利用ESP定律手脱nSPack的壳，感觉比较好脱，第一次学习记录一下。

下面记录一下以SHCTF2017的crackme的一个题来展现过程。

查壳是nSPack,PEwin32,直接拖入OD进行手脱。
导入程序后F8单步，在call 处下硬件断点

然后直接F9跳转到ESP定律的落脚点，F8单步一次就是OEP的入口，再单步进入就会发现

选择删除模块就会进入入口点，此时利用od自带的插件dump出即可完成脱壳。

此题到这已经基本完成了，手脱nSPcak的壳也复现完了.

接下来写完此题的其他步骤，脱完壳之后的程序的逻辑已经是很简单了。直接放入ida分析。
逻辑很简单就是一个简单的异或。

找出数据直接写脚本可以解出。

```
fake = 'this_is_not_flag'
dword_402150 = [0x12,0x04, 0x08, 0x14, 0x24, 0x5C, 0x4A, 0x3D, 0x56, 0x0A, 0x10, 0x67,
		0x00,0x41,0x00,0x01,0x46,0x5a,0x44,0x42,0x6e,0x0C,0x44,0x72,0x0C,0x0D,0x40,
		0x3E, 0x4B, 0x5F, 0x02, 0x01, 0x4C, 0x5E, 0x5B, 0x17, 0x6E, 0x0C,
		0x16,0x68,0x5b,0x12,0x02,0x48,0x0E]
flag = ''
for i in range(0,42):
	flag += chr(dword_402150[i] ^ ord(fake[i%16]))
print flag

```